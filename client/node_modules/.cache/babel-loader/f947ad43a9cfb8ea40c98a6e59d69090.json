{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\n\nvar _class, _temp;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _lodash = require('lodash.map');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _lodash3 = require('lodash.reduce');\n\nvar _lodash4 = _interopRequireDefault(_lodash3);\n\nvar _lodash5 = require('lodash.filter');\n\nvar _lodash6 = _interopRequireDefault(_lodash5);\n\nvar _lodash7 = require('lodash.min');\n\nvar _lodash8 = _interopRequireDefault(_lodash7);\n\nvar _lodash9 = require('lodash.max');\n\nvar _lodash10 = _interopRequireDefault(_lodash9);\n\nvar _lodash11 = require('lodash.isnumber');\n\nvar _lodash12 = _interopRequireDefault(_lodash11);\n\nvar _leaflet = require('leaflet');\n\nvar _leaflet2 = _interopRequireDefault(_leaflet);\n\nvar _reactLeaflet = require('react-leaflet');\n\nvar _simpleheat = require('simpleheat');\n\nvar _simpleheat2 = _interopRequireDefault(_simpleheat);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nfunction isInvalid(num) {\n  return !(0, _lodash12.default)(num) && !num;\n}\n\nfunction isValid(num) {\n  return !isInvalid(num);\n}\n\nfunction isValidLatLngArray(arr) {\n  return (0, _lodash6.default)(arr, isValid).length === arr.length;\n}\n\nfunction isInvalidLatLngArray(arr) {\n  return !isValidLatLngArray(arr);\n}\n\nfunction safeRemoveLayer(leafletMap, el) {\n  var _leafletMap$getPanes = leafletMap.getPanes(),\n      overlayPane = _leafletMap$getPanes.overlayPane;\n\n  if (overlayPane && overlayPane.contains(el)) {\n    overlayPane.removeChild(el);\n  }\n}\n\nfunction shouldIgnoreLocation(loc) {\n  return isInvalid(loc.lng) || isInvalid(loc.lat);\n}\n\nexports.default = (0, _reactLeaflet.withLeaflet)((_temp = _class = function (_MapLayer) {\n  _inherits(HeatmapLayer, _MapLayer);\n\n  function HeatmapLayer() {\n    _classCallCheck(this, HeatmapLayer);\n\n    return _possibleConstructorReturn(this, _MapLayer.apply(this, arguments));\n  }\n\n  HeatmapLayer.prototype.createLeafletElement = function createLeafletElement() {\n    return null;\n  };\n\n  HeatmapLayer.prototype.componentDidMount = function componentDidMount() {\n    var _this2 = this;\n\n    var canAnimate = this.props.leaflet.map.options.zoomAnimation && _leaflet2.default.Browser.any3d;\n    var zoomClass = 'leaflet-zoom-' + (canAnimate ? 'animated' : 'hide');\n    var mapSize = this.props.leaflet.map.getSize();\n\n    var transformProp = _leaflet2.default.DomUtil.testProp(['transformOrigin', 'WebkitTransformOrigin', 'msTransformOrigin']);\n\n    this._el = _leaflet2.default.DomUtil.create('canvas', zoomClass);\n    this._el.style[transformProp] = '50% 50%';\n    this._el.width = mapSize.x;\n    this._el.height = mapSize.y;\n    var el = this._el;\n\n    var Heatmap = _leaflet2.default.Layer.extend({\n      onAdd: function onAdd(leafletMap) {\n        return leafletMap.getPanes().overlayPane.appendChild(el);\n      },\n      addTo: function addTo(leafletMap) {\n        leafletMap.addLayer(_this2);\n        return _this2;\n      },\n      onRemove: function onRemove(leafletMap) {\n        return safeRemoveLayer(leafletMap, el);\n      }\n    });\n\n    this.leafletElement = new Heatmap();\n\n    _MapLayer.prototype.componentDidMount.call(this);\n\n    this._heatmap = (0, _simpleheat2.default)(this._el);\n    this.reset();\n\n    if (this.props.fitBoundsOnLoad) {\n      this.fitBounds();\n    }\n\n    this.attachEvents();\n    this.updateHeatmapProps(this.getHeatmapProps(this.props));\n  };\n\n  HeatmapLayer.prototype.getMax = function getMax(props) {\n    return props.max || 3.0;\n  };\n\n  HeatmapLayer.prototype.getRadius = function getRadius(props) {\n    return props.radius || 30;\n  };\n\n  HeatmapLayer.prototype.getMaxZoom = function getMaxZoom(props) {\n    return props.maxZoom || 18;\n  };\n\n  HeatmapLayer.prototype.getMinOpacity = function getMinOpacity(props) {\n    return props.minOpacity || 0.01;\n  };\n\n  HeatmapLayer.prototype.getBlur = function getBlur(props) {\n    return props.blur || 15;\n  };\n\n  HeatmapLayer.prototype.getHeatmapProps = function getHeatmapProps(props) {\n    return {\n      minOpacity: this.getMinOpacity(props),\n      maxZoom: this.getMaxZoom(props),\n      radius: this.getRadius(props),\n      blur: this.getBlur(props),\n      max: this.getMax(props),\n      gradient: props.gradient\n    };\n  };\n\n  HeatmapLayer.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    var currentProps = this.props;\n    var nextHeatmapProps = this.getHeatmapProps(nextProps);\n    this.updateHeatmapGradient(nextHeatmapProps.gradient);\n    var hasRadiusUpdated = nextHeatmapProps.radius !== currentProps.radius;\n    var hasBlurUpdated = nextHeatmapProps.blur !== currentProps.blur;\n\n    if (hasRadiusUpdated || hasBlurUpdated) {\n      this.updateHeatmapRadius(nextHeatmapProps.radius, nextHeatmapProps.blur);\n    }\n\n    if (nextHeatmapProps.max !== currentProps.max) {\n      this.updateHeatmapMax(nextHeatmapProps.max);\n    }\n  };\n  /**\r\n   * Update various heatmap properties like radius, gradient, and max\r\n   */\n\n\n  HeatmapLayer.prototype.updateHeatmapProps = function updateHeatmapProps(props) {\n    this.updateHeatmapRadius(props.radius, props.blur);\n    this.updateHeatmapGradient(props.gradient);\n    this.updateHeatmapMax(props.max);\n  };\n  /**\r\n   * Update the heatmap's radius and blur (blur is optional)\r\n   */\n\n\n  HeatmapLayer.prototype.updateHeatmapRadius = function updateHeatmapRadius(radius, blur) {\n    if (radius) {\n      this._heatmap.radius(radius, blur);\n    }\n  };\n  /**\r\n   * Update the heatmap's gradient\r\n   */\n\n\n  HeatmapLayer.prototype.updateHeatmapGradient = function updateHeatmapGradient(gradient) {\n    if (gradient) {\n      this._heatmap.gradient(gradient);\n    }\n  };\n  /**\r\n   * Update the heatmap's maximum\r\n   */\n\n\n  HeatmapLayer.prototype.updateHeatmapMax = function updateHeatmapMax(maximum) {\n    if (maximum) {\n      this._heatmap.max(maximum);\n    }\n  };\n\n  HeatmapLayer.prototype.componentWillUnmount = function componentWillUnmount() {\n    safeRemoveLayer(this.props.leaflet.map, this._el);\n  };\n\n  HeatmapLayer.prototype.fitBounds = function fitBounds() {\n    var points = this.props.points;\n    var lngs = (0, _lodash2.default)(points, this.props.longitudeExtractor);\n    var lats = (0, _lodash2.default)(points, this.props.latitudeExtractor);\n    var ne = {\n      lng: (0, _lodash10.default)(lngs),\n      lat: (0, _lodash10.default)(lats)\n    };\n    var sw = {\n      lng: (0, _lodash8.default)(lngs),\n      lat: (0, _lodash8.default)(lats)\n    };\n\n    if (shouldIgnoreLocation(ne) || shouldIgnoreLocation(sw)) {\n      return;\n    }\n\n    this.props.leaflet.map.fitBounds(_leaflet2.default.latLngBounds(_leaflet2.default.latLng(sw), _leaflet2.default.latLng(ne)));\n  };\n\n  HeatmapLayer.prototype.componentDidUpdate = function componentDidUpdate() {\n    this.props.leaflet.map.invalidateSize();\n\n    if (this.props.fitBoundsOnUpdate) {\n      this.fitBounds();\n    }\n\n    this.reset();\n  };\n\n  HeatmapLayer.prototype.shouldComponentUpdate = function shouldComponentUpdate() {\n    return true;\n  };\n\n  HeatmapLayer.prototype.attachEvents = function attachEvents() {\n    var _this3 = this;\n\n    var leafletMap = this.props.leaflet.map;\n    leafletMap.on('viewreset', function () {\n      return _this3.reset();\n    });\n    leafletMap.on('moveend', function () {\n      return _this3.reset();\n    });\n\n    if (leafletMap.options.zoomAnimation && _leaflet2.default.Browser.any3d) {\n      leafletMap.on('zoomanim', this._animateZoom, this);\n    }\n  };\n\n  HeatmapLayer.prototype._animateZoom = function _animateZoom(e) {\n    var scale = this.props.leaflet.map.getZoomScale(e.zoom);\n\n    var offset = this.props.leaflet.map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this.props.leaflet.map._getMapPanePos());\n\n    if (_leaflet2.default.DomUtil.setTransform) {\n      _leaflet2.default.DomUtil.setTransform(this._el, offset, scale);\n    } else {\n      this._el.style[_leaflet2.default.DomUtil.TRANSFORM] = _leaflet2.default.DomUtil.getTranslateString(offset) + ' scale(' + scale + ')';\n    }\n  };\n\n  HeatmapLayer.prototype.reset = function reset() {\n    var topLeft = this.props.leaflet.map.containerPointToLayerPoint([0, 0]);\n\n    _leaflet2.default.DomUtil.setPosition(this._el, topLeft);\n\n    var size = this.props.leaflet.map.getSize();\n\n    if (this._heatmap._width !== size.x) {\n      this._el.width = this._heatmap._width = size.x;\n    }\n\n    if (this._heatmap._height !== size.y) {\n      this._el.height = this._heatmap._height = size.y;\n    }\n\n    if (this._heatmap && !this._frame && !this.props.leaflet.map._animating) {\n      this._frame = _leaflet2.default.Util.requestAnimFrame(this.redraw, this);\n    }\n\n    this.redraw();\n  };\n\n  HeatmapLayer.prototype.redraw = function redraw() {\n    var r = this._heatmap._r;\n    var size = this.props.leaflet.map.getSize();\n    var maxIntensity = this.props.max === undefined ? 1 : this.getMax(this.props);\n    var maxZoom = this.props.maxZoom === undefined ? this.props.leaflet.map.getMaxZoom() : this.getMaxZoom(this.props);\n    var v = 1 / Math.pow(2, Math.max(0, Math.min(maxZoom - this.props.leaflet.map.getZoom(), 12)) / 2);\n    var cellSize = r / 2;\n\n    var panePos = this.props.leaflet.map._getMapPanePos();\n\n    var offsetX = panePos.x % cellSize;\n    var offsetY = panePos.y % cellSize;\n    var getLat = this.props.latitudeExtractor;\n    var getLng = this.props.longitudeExtractor;\n    var getIntensity = this.props.intensityExtractor;\n\n    var inBounds = function inBounds(p, bounds) {\n      return bounds.contains(p);\n    };\n\n    var filterUndefined = function filterUndefined(row) {\n      return (0, _lodash6.default)(row, function (c) {\n        return c !== undefined;\n      });\n    };\n\n    var roundResults = function roundResults(results) {\n      return (0, _lodash4.default)(results, function (result, row) {\n        return (0, _lodash2.default)(filterUndefined(row), function (cell) {\n          return [Math.round(cell[0]), Math.round(cell[1]), Math.min(cell[2], maxIntensity), cell[3]];\n        }).concat(result);\n      }, []);\n    };\n\n    var accumulateInGrid = function accumulateInGrid(points, leafletMap, bounds) {\n      return (0, _lodash4.default)(points, function (grid, point) {\n        var latLng = [getLat(point), getLng(point)];\n\n        if (isInvalidLatLngArray(latLng)) {\n          //skip invalid points\n          return grid;\n        }\n\n        var p = leafletMap.latLngToContainerPoint(latLng);\n\n        if (!inBounds(p, bounds)) {\n          return grid;\n        }\n\n        var x = Math.floor((p.x - offsetX) / cellSize) + 2;\n        var y = Math.floor((p.y - offsetY) / cellSize) + 2;\n        grid[y] = grid[y] || [];\n        var cell = grid[y][x];\n        var alt = getIntensity(point);\n        var k = alt * v;\n\n        if (!cell) {\n          grid[y][x] = [p.x, p.y, k, 1];\n        } else {\n          cell[0] = (cell[0] * cell[2] + p.x * k) / (cell[2] + k); // x\n\n          cell[1] = (cell[1] * cell[2] + p.y * k) / (cell[2] + k); // y\n\n          cell[2] += k; // accumulated intensity value\n\n          cell[3] += 1;\n        }\n\n        return grid;\n      }, []);\n    };\n\n    var getBounds = function getBounds() {\n      return new _leaflet2.default.Bounds(_leaflet2.default.point([-r, -r]), size.add([r, r]));\n    };\n\n    var getDataForHeatmap = function getDataForHeatmap(points, leafletMap) {\n      return roundResults(accumulateInGrid(points, leafletMap, getBounds(leafletMap)));\n    };\n\n    var data = getDataForHeatmap(this.props.points, this.props.leaflet.map);\n\n    this._heatmap.clear();\n\n    this._heatmap.data(data).draw(this.getMinOpacity(this.props));\n\n    this._frame = null;\n\n    if (this.props.onStatsUpdate && this.props.points && this.props.points.length > 0) {\n      this.props.onStatsUpdate((0, _lodash4.default)(data, function (stats, point) {\n        stats.max = point[3] > stats.max ? point[3] : stats.max;\n        stats.min = point[3] < stats.min ? point[3] : stats.min;\n        return stats;\n      }, {\n        min: Infinity,\n        max: -Infinity\n      }));\n    }\n  };\n\n  HeatmapLayer.prototype.render = function render() {\n    return null;\n  };\n\n  return HeatmapLayer;\n}(_reactLeaflet.MapLayer), _class.propTypes = {\n  points: _propTypes2.default.array.isRequired,\n  longitudeExtractor: _propTypes2.default.func.isRequired,\n  latitudeExtractor: _propTypes2.default.func.isRequired,\n  intensityExtractor: _propTypes2.default.func.isRequired,\n  fitBoundsOnLoad: _propTypes2.default.bool,\n  fitBoundsOnUpdate: _propTypes2.default.bool,\n  onStatsUpdate: _propTypes2.default.func,\n\n  /* props controlling heatmap generation */\n  max: _propTypes2.default.number,\n  radius: _propTypes2.default.number,\n  maxZoom: _propTypes2.default.number,\n  minOpacity: _propTypes2.default.number,\n  blur: _propTypes2.default.number,\n  gradient: _propTypes2.default.object\n}, _temp));","map":{"version":3,"sources":["C:/Users/mdari/Desktop/416 Project/CSE-416-Project/client/node_modules/react-leaflet-heatmap-layer/lib/HeatmapLayer.js"],"names":["exports","__esModule","_class","_temp","_react","require","_react2","_interopRequireDefault","_lodash","_lodash2","_lodash3","_lodash4","_lodash5","_lodash6","_lodash7","_lodash8","_lodash9","_lodash10","_lodash11","_lodash12","_leaflet","_leaflet2","_reactLeaflet","_simpleheat","_simpleheat2","_propTypes","_propTypes2","obj","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","isInvalid","num","isValid","isValidLatLngArray","arr","length","isInvalidLatLngArray","safeRemoveLayer","leafletMap","el","_leafletMap$getPanes","getPanes","overlayPane","contains","removeChild","shouldIgnoreLocation","loc","lng","lat","withLeaflet","_MapLayer","HeatmapLayer","apply","arguments","createLeafletElement","componentDidMount","_this2","canAnimate","props","leaflet","map","options","zoomAnimation","Browser","any3d","zoomClass","mapSize","getSize","transformProp","DomUtil","testProp","_el","style","width","x","height","y","Heatmap","Layer","extend","onAdd","appendChild","addTo","addLayer","onRemove","leafletElement","_heatmap","reset","fitBoundsOnLoad","fitBounds","attachEvents","updateHeatmapProps","getHeatmapProps","getMax","max","getRadius","radius","getMaxZoom","maxZoom","getMinOpacity","minOpacity","getBlur","blur","gradient","componentWillReceiveProps","nextProps","currentProps","nextHeatmapProps","updateHeatmapGradient","hasRadiusUpdated","hasBlurUpdated","updateHeatmapRadius","updateHeatmapMax","maximum","componentWillUnmount","points","lngs","longitudeExtractor","lats","latitudeExtractor","ne","sw","latLngBounds","latLng","componentDidUpdate","invalidateSize","fitBoundsOnUpdate","shouldComponentUpdate","_this3","on","_animateZoom","e","scale","getZoomScale","zoom","offset","_getCenterOffset","center","_multiplyBy","subtract","_getMapPanePos","setTransform","TRANSFORM","getTranslateString","topLeft","containerPointToLayerPoint","setPosition","size","_width","_height","_frame","_animating","Util","requestAnimFrame","redraw","r","_r","maxIntensity","undefined","v","Math","pow","min","getZoom","cellSize","panePos","offsetX","offsetY","getLat","getLng","getIntensity","intensityExtractor","inBounds","p","bounds","filterUndefined","row","c","roundResults","results","result","cell","round","concat","accumulateInGrid","grid","point","latLngToContainerPoint","floor","alt","k","getBounds","Bounds","add","getDataForHeatmap","data","clear","draw","onStatsUpdate","stats","Infinity","render","MapLayer","propTypes","array","isRequired","func","bool","number","object"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nexports.__esModule = true;\r\n\r\nvar _class, _temp;\r\n\r\nvar _react = require('react');\r\n\r\nvar _react2 = _interopRequireDefault(_react);\r\n\r\nvar _lodash = require('lodash.map');\r\n\r\nvar _lodash2 = _interopRequireDefault(_lodash);\r\n\r\nvar _lodash3 = require('lodash.reduce');\r\n\r\nvar _lodash4 = _interopRequireDefault(_lodash3);\r\n\r\nvar _lodash5 = require('lodash.filter');\r\n\r\nvar _lodash6 = _interopRequireDefault(_lodash5);\r\n\r\nvar _lodash7 = require('lodash.min');\r\n\r\nvar _lodash8 = _interopRequireDefault(_lodash7);\r\n\r\nvar _lodash9 = require('lodash.max');\r\n\r\nvar _lodash10 = _interopRequireDefault(_lodash9);\r\n\r\nvar _lodash11 = require('lodash.isnumber');\r\n\r\nvar _lodash12 = _interopRequireDefault(_lodash11);\r\n\r\nvar _leaflet = require('leaflet');\r\n\r\nvar _leaflet2 = _interopRequireDefault(_leaflet);\r\n\r\nvar _reactLeaflet = require('react-leaflet');\r\n\r\nvar _simpleheat = require('simpleheat');\r\n\r\nvar _simpleheat2 = _interopRequireDefault(_simpleheat);\r\n\r\nvar _propTypes = require('prop-types');\r\n\r\nvar _propTypes2 = _interopRequireDefault(_propTypes);\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\r\n\r\nfunction isInvalid(num) {\r\n  return !(0, _lodash12.default)(num) && !num;\r\n}\r\n\r\nfunction isValid(num) {\r\n  return !isInvalid(num);\r\n}\r\n\r\nfunction isValidLatLngArray(arr) {\r\n  return (0, _lodash6.default)(arr, isValid).length === arr.length;\r\n}\r\n\r\nfunction isInvalidLatLngArray(arr) {\r\n  return !isValidLatLngArray(arr);\r\n}\r\n\r\nfunction safeRemoveLayer(leafletMap, el) {\r\n  var _leafletMap$getPanes = leafletMap.getPanes(),\r\n      overlayPane = _leafletMap$getPanes.overlayPane;\r\n\r\n  if (overlayPane && overlayPane.contains(el)) {\r\n    overlayPane.removeChild(el);\r\n  }\r\n}\r\n\r\nfunction shouldIgnoreLocation(loc) {\r\n  return isInvalid(loc.lng) || isInvalid(loc.lat);\r\n}\r\n\r\nexports.default = (0, _reactLeaflet.withLeaflet)((_temp = _class = function (_MapLayer) {\r\n  _inherits(HeatmapLayer, _MapLayer);\r\n\r\n  function HeatmapLayer() {\r\n    _classCallCheck(this, HeatmapLayer);\r\n\r\n    return _possibleConstructorReturn(this, _MapLayer.apply(this, arguments));\r\n  }\r\n\r\n  HeatmapLayer.prototype.createLeafletElement = function createLeafletElement() {\r\n    return null;\r\n  };\r\n\r\n  HeatmapLayer.prototype.componentDidMount = function componentDidMount() {\r\n    var _this2 = this;\r\n\r\n    var canAnimate = this.props.leaflet.map.options.zoomAnimation && _leaflet2.default.Browser.any3d;\r\n    var zoomClass = 'leaflet-zoom-' + (canAnimate ? 'animated' : 'hide');\r\n    var mapSize = this.props.leaflet.map.getSize();\r\n    var transformProp = _leaflet2.default.DomUtil.testProp(['transformOrigin', 'WebkitTransformOrigin', 'msTransformOrigin']);\r\n\r\n    this._el = _leaflet2.default.DomUtil.create('canvas', zoomClass);\r\n    this._el.style[transformProp] = '50% 50%';\r\n    this._el.width = mapSize.x;\r\n    this._el.height = mapSize.y;\r\n\r\n    var el = this._el;\r\n\r\n    var Heatmap = _leaflet2.default.Layer.extend({\r\n      onAdd: function onAdd(leafletMap) {\r\n        return leafletMap.getPanes().overlayPane.appendChild(el);\r\n      },\r\n      addTo: function addTo(leafletMap) {\r\n        leafletMap.addLayer(_this2);\r\n        return _this2;\r\n      },\r\n      onRemove: function onRemove(leafletMap) {\r\n        return safeRemoveLayer(leafletMap, el);\r\n      }\r\n    });\r\n\r\n    this.leafletElement = new Heatmap();\r\n    _MapLayer.prototype.componentDidMount.call(this);\r\n    this._heatmap = (0, _simpleheat2.default)(this._el);\r\n    this.reset();\r\n\r\n    if (this.props.fitBoundsOnLoad) {\r\n      this.fitBounds();\r\n    }\r\n    this.attachEvents();\r\n    this.updateHeatmapProps(this.getHeatmapProps(this.props));\r\n  };\r\n\r\n  HeatmapLayer.prototype.getMax = function getMax(props) {\r\n    return props.max || 3.0;\r\n  };\r\n\r\n  HeatmapLayer.prototype.getRadius = function getRadius(props) {\r\n    return props.radius || 30;\r\n  };\r\n\r\n  HeatmapLayer.prototype.getMaxZoom = function getMaxZoom(props) {\r\n    return props.maxZoom || 18;\r\n  };\r\n\r\n  HeatmapLayer.prototype.getMinOpacity = function getMinOpacity(props) {\r\n    return props.minOpacity || 0.01;\r\n  };\r\n\r\n  HeatmapLayer.prototype.getBlur = function getBlur(props) {\r\n    return props.blur || 15;\r\n  };\r\n\r\n  HeatmapLayer.prototype.getHeatmapProps = function getHeatmapProps(props) {\r\n    return {\r\n      minOpacity: this.getMinOpacity(props),\r\n      maxZoom: this.getMaxZoom(props),\r\n      radius: this.getRadius(props),\r\n      blur: this.getBlur(props),\r\n      max: this.getMax(props),\r\n      gradient: props.gradient\r\n    };\r\n  };\r\n\r\n  HeatmapLayer.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\r\n    var currentProps = this.props;\r\n    var nextHeatmapProps = this.getHeatmapProps(nextProps);\r\n\r\n    this.updateHeatmapGradient(nextHeatmapProps.gradient);\r\n\r\n    var hasRadiusUpdated = nextHeatmapProps.radius !== currentProps.radius;\r\n    var hasBlurUpdated = nextHeatmapProps.blur !== currentProps.blur;\r\n\r\n    if (hasRadiusUpdated || hasBlurUpdated) {\r\n      this.updateHeatmapRadius(nextHeatmapProps.radius, nextHeatmapProps.blur);\r\n    }\r\n\r\n    if (nextHeatmapProps.max !== currentProps.max) {\r\n      this.updateHeatmapMax(nextHeatmapProps.max);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Update various heatmap properties like radius, gradient, and max\r\n   */\r\n\r\n\r\n  HeatmapLayer.prototype.updateHeatmapProps = function updateHeatmapProps(props) {\r\n    this.updateHeatmapRadius(props.radius, props.blur);\r\n    this.updateHeatmapGradient(props.gradient);\r\n    this.updateHeatmapMax(props.max);\r\n  };\r\n\r\n  /**\r\n   * Update the heatmap's radius and blur (blur is optional)\r\n   */\r\n\r\n\r\n  HeatmapLayer.prototype.updateHeatmapRadius = function updateHeatmapRadius(radius, blur) {\r\n    if (radius) {\r\n      this._heatmap.radius(radius, blur);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Update the heatmap's gradient\r\n   */\r\n\r\n\r\n  HeatmapLayer.prototype.updateHeatmapGradient = function updateHeatmapGradient(gradient) {\r\n    if (gradient) {\r\n      this._heatmap.gradient(gradient);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Update the heatmap's maximum\r\n   */\r\n\r\n\r\n  HeatmapLayer.prototype.updateHeatmapMax = function updateHeatmapMax(maximum) {\r\n    if (maximum) {\r\n      this._heatmap.max(maximum);\r\n    }\r\n  };\r\n\r\n  HeatmapLayer.prototype.componentWillUnmount = function componentWillUnmount() {\r\n    safeRemoveLayer(this.props.leaflet.map, this._el);\r\n  };\r\n\r\n  HeatmapLayer.prototype.fitBounds = function fitBounds() {\r\n    var points = this.props.points;\r\n    var lngs = (0, _lodash2.default)(points, this.props.longitudeExtractor);\r\n    var lats = (0, _lodash2.default)(points, this.props.latitudeExtractor);\r\n    var ne = { lng: (0, _lodash10.default)(lngs), lat: (0, _lodash10.default)(lats) };\r\n    var sw = { lng: (0, _lodash8.default)(lngs), lat: (0, _lodash8.default)(lats) };\r\n\r\n    if (shouldIgnoreLocation(ne) || shouldIgnoreLocation(sw)) {\r\n      return;\r\n    }\r\n\r\n    this.props.leaflet.map.fitBounds(_leaflet2.default.latLngBounds(_leaflet2.default.latLng(sw), _leaflet2.default.latLng(ne)));\r\n  };\r\n\r\n  HeatmapLayer.prototype.componentDidUpdate = function componentDidUpdate() {\r\n    this.props.leaflet.map.invalidateSize();\r\n    if (this.props.fitBoundsOnUpdate) {\r\n      this.fitBounds();\r\n    }\r\n    this.reset();\r\n  };\r\n\r\n  HeatmapLayer.prototype.shouldComponentUpdate = function shouldComponentUpdate() {\r\n    return true;\r\n  };\r\n\r\n  HeatmapLayer.prototype.attachEvents = function attachEvents() {\r\n    var _this3 = this;\r\n\r\n    var leafletMap = this.props.leaflet.map;\r\n    leafletMap.on('viewreset', function () {\r\n      return _this3.reset();\r\n    });\r\n    leafletMap.on('moveend', function () {\r\n      return _this3.reset();\r\n    });\r\n    if (leafletMap.options.zoomAnimation && _leaflet2.default.Browser.any3d) {\r\n      leafletMap.on('zoomanim', this._animateZoom, this);\r\n    }\r\n  };\r\n\r\n  HeatmapLayer.prototype._animateZoom = function _animateZoom(e) {\r\n    var scale = this.props.leaflet.map.getZoomScale(e.zoom);\r\n    var offset = this.props.leaflet.map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this.props.leaflet.map._getMapPanePos());\r\n\r\n    if (_leaflet2.default.DomUtil.setTransform) {\r\n      _leaflet2.default.DomUtil.setTransform(this._el, offset, scale);\r\n    } else {\r\n      this._el.style[_leaflet2.default.DomUtil.TRANSFORM] = _leaflet2.default.DomUtil.getTranslateString(offset) + ' scale(' + scale + ')';\r\n    }\r\n  };\r\n\r\n  HeatmapLayer.prototype.reset = function reset() {\r\n    var topLeft = this.props.leaflet.map.containerPointToLayerPoint([0, 0]);\r\n    _leaflet2.default.DomUtil.setPosition(this._el, topLeft);\r\n\r\n    var size = this.props.leaflet.map.getSize();\r\n\r\n    if (this._heatmap._width !== size.x) {\r\n      this._el.width = this._heatmap._width = size.x;\r\n    }\r\n    if (this._heatmap._height !== size.y) {\r\n      this._el.height = this._heatmap._height = size.y;\r\n    }\r\n\r\n    if (this._heatmap && !this._frame && !this.props.leaflet.map._animating) {\r\n      this._frame = _leaflet2.default.Util.requestAnimFrame(this.redraw, this);\r\n    }\r\n\r\n    this.redraw();\r\n  };\r\n\r\n  HeatmapLayer.prototype.redraw = function redraw() {\r\n    var r = this._heatmap._r;\r\n    var size = this.props.leaflet.map.getSize();\r\n\r\n    var maxIntensity = this.props.max === undefined ? 1 : this.getMax(this.props);\r\n\r\n    var maxZoom = this.props.maxZoom === undefined ? this.props.leaflet.map.getMaxZoom() : this.getMaxZoom(this.props);\r\n\r\n    var v = 1 / Math.pow(2, Math.max(0, Math.min(maxZoom - this.props.leaflet.map.getZoom(), 12)) / 2);\r\n\r\n    var cellSize = r / 2;\r\n    var panePos = this.props.leaflet.map._getMapPanePos();\r\n    var offsetX = panePos.x % cellSize;\r\n    var offsetY = panePos.y % cellSize;\r\n    var getLat = this.props.latitudeExtractor;\r\n    var getLng = this.props.longitudeExtractor;\r\n    var getIntensity = this.props.intensityExtractor;\r\n\r\n    var inBounds = function inBounds(p, bounds) {\r\n      return bounds.contains(p);\r\n    };\r\n\r\n    var filterUndefined = function filterUndefined(row) {\r\n      return (0, _lodash6.default)(row, function (c) {\r\n        return c !== undefined;\r\n      });\r\n    };\r\n\r\n    var roundResults = function roundResults(results) {\r\n      return (0, _lodash4.default)(results, function (result, row) {\r\n        return (0, _lodash2.default)(filterUndefined(row), function (cell) {\r\n          return [Math.round(cell[0]), Math.round(cell[1]), Math.min(cell[2], maxIntensity), cell[3]];\r\n        }).concat(result);\r\n      }, []);\r\n    };\r\n\r\n    var accumulateInGrid = function accumulateInGrid(points, leafletMap, bounds) {\r\n      return (0, _lodash4.default)(points, function (grid, point) {\r\n        var latLng = [getLat(point), getLng(point)];\r\n        if (isInvalidLatLngArray(latLng)) {\r\n          //skip invalid points\r\n          return grid;\r\n        }\r\n\r\n        var p = leafletMap.latLngToContainerPoint(latLng);\r\n\r\n        if (!inBounds(p, bounds)) {\r\n          return grid;\r\n        }\r\n\r\n        var x = Math.floor((p.x - offsetX) / cellSize) + 2;\r\n        var y = Math.floor((p.y - offsetY) / cellSize) + 2;\r\n\r\n        grid[y] = grid[y] || [];\r\n        var cell = grid[y][x];\r\n\r\n        var alt = getIntensity(point);\r\n        var k = alt * v;\r\n\r\n        if (!cell) {\r\n          grid[y][x] = [p.x, p.y, k, 1];\r\n        } else {\r\n          cell[0] = (cell[0] * cell[2] + p.x * k) / (cell[2] + k); // x\r\n          cell[1] = (cell[1] * cell[2] + p.y * k) / (cell[2] + k); // y\r\n          cell[2] += k; // accumulated intensity value\r\n          cell[3] += 1;\r\n        }\r\n\r\n        return grid;\r\n      }, []);\r\n    };\r\n\r\n    var getBounds = function getBounds() {\r\n      return new _leaflet2.default.Bounds(_leaflet2.default.point([-r, -r]), size.add([r, r]));\r\n    };\r\n\r\n    var getDataForHeatmap = function getDataForHeatmap(points, leafletMap) {\r\n      return roundResults(accumulateInGrid(points, leafletMap, getBounds(leafletMap)));\r\n    };\r\n\r\n    var data = getDataForHeatmap(this.props.points, this.props.leaflet.map);\r\n\r\n    this._heatmap.clear();\r\n    this._heatmap.data(data).draw(this.getMinOpacity(this.props));\r\n\r\n    this._frame = null;\r\n\r\n    if (this.props.onStatsUpdate && this.props.points && this.props.points.length > 0) {\r\n      this.props.onStatsUpdate((0, _lodash4.default)(data, function (stats, point) {\r\n        stats.max = point[3] > stats.max ? point[3] : stats.max;\r\n        stats.min = point[3] < stats.min ? point[3] : stats.min;\r\n        return stats;\r\n      }, { min: Infinity, max: -Infinity }));\r\n    }\r\n  };\r\n\r\n  HeatmapLayer.prototype.render = function render() {\r\n    return null;\r\n  };\r\n\r\n  return HeatmapLayer;\r\n}(_reactLeaflet.MapLayer), _class.propTypes = {\r\n  points: _propTypes2.default.array.isRequired,\r\n  longitudeExtractor: _propTypes2.default.func.isRequired,\r\n  latitudeExtractor: _propTypes2.default.func.isRequired,\r\n  intensityExtractor: _propTypes2.default.func.isRequired,\r\n  fitBoundsOnLoad: _propTypes2.default.bool,\r\n  fitBoundsOnUpdate: _propTypes2.default.bool,\r\n  onStatsUpdate: _propTypes2.default.func,\r\n  /* props controlling heatmap generation */\r\n  max: _propTypes2.default.number,\r\n  radius: _propTypes2.default.number,\r\n  maxZoom: _propTypes2.default.number,\r\n  minOpacity: _propTypes2.default.number,\r\n  blur: _propTypes2.default.number,\r\n  gradient: _propTypes2.default.object\r\n}, _temp));\r\n"]},"metadata":{},"sourceType":"script"}